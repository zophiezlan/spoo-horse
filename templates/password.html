<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîí Password Protected - my.ket.horse</title>

    <!-- Meta Tags -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">
    <meta name="description" content="This link is password protected. Enter the password to continue.">
    <meta name="theme-color" content="#764ba2">

    <!-- Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/reset.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/design-system.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/print.css') }}" media="print">

    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        .password-container {
            max-width: 500px;
            width: 100%;
            animation: fadeIn 0.6s ease;
        }

        .lock-icon {
            font-size: 80px;
            text-align: center;
            margin-bottom: 24px;
            animation: pulse 2s ease-in-out infinite;
        }

        .url-display {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 32px;
            text-align: center;
        }

        .url-text {
            font-family: 'SFMono-Regular', Consolas, monospace;
            font-size: 16px;
            color: var(--accent-blue);
            word-break: break-all;
            font-weight: 600;
        }

        .password-form {
            margin: 32px 0;
        }

        .password-input-group {
            position: relative;
            margin-bottom: 24px;
        }

        .password-toggle {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 20px;
            padding: 4px;
            transition: color var(--transition-fast);
        }

        .password-toggle:hover {
            color: var(--text-primary);
        }

        .password-hint {
            background: rgba(135, 206, 235, 0.1);
            border: 1px solid var(--accent-blue);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-top: 24px;
        }

        .password-hint-title {
            font-weight: 600;
            color: var(--accent-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .password-hint-text {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .security-note {
            text-align: center;
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--glass-border);
        }

        .shake {
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .input-field.error {
            border-color: var(--accent-error);
            animation: shake 0.5s ease;
        }

        @media (max-width: 768px) {
            .lock-icon {
                font-size: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="container-sm">
        <div class="password-container">
            <div class="glass-card">
                <!-- Lock Icon -->
                <div class="lock-icon">üîí</div>

                <!-- Title -->
                <h1 style="text-align: center; margin-bottom: 16px;">
                    Password Protected Link
                </h1>
                <p style="text-align: center; color: var(--text-muted); margin-bottom: 32px;">
                    This shortened URL requires a password to access
                </p>

                <!-- URL Display -->
                <div class="url-display">
                    <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px;">
                        Protected URL
                    </div>
                    <div class="url-text">{{ host_url }}{{ short_code }}</div>
                </div>

                <!-- Password Form -->
                <form class="password-form" method="POST" action="{{ url_for('url_redirector.check_password', short_code=short_code) }}" id="passwordForm">
                    <div class="input-group">
                        <label class="input-label" for="password">
                            üîë Enter Password
                        </label>
                        <div class="password-input-group">
                            <input
                                type="password"
                                name="password"
                                id="password"
                                class="input-field {% if error %}error{% endif %}"
                                placeholder="Enter the password..."
                                required
                                autofocus
                                autocomplete="current-password"
                            >
                            <button type="button" class="password-toggle" onclick="togglePassword()" aria-label="Toggle password visibility">
                                <span id="toggleIcon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>

                    {% if error %}
                    <div class="error-message" style="margin-bottom: 24px;">
                        <strong>‚ö†Ô∏è Incorrect Password</strong><br>
                        {{ error }}
                    </div>
                    {% endif %}

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        üîì Unlock & Continue
                    </button>
                </form>

                <!-- Password Hint -->
                <div class="password-hint">
                    <div class="password-hint-title">
                        üí° Password Requirements
                    </div>
                    <div class="password-hint-text">
                        ‚Ä¢ Minimum 8 characters<br>
                        ‚Ä¢ Must contain letters and numbers<br>
                        ‚Ä¢ May contain special characters (@ or .)
                    </div>
                </div>

                <!-- Security Note -->
                <div class="security-note">
                    <p>
                        üõ°Ô∏è This link was protected by its creator for security.<br>
                        If you don't have the password, please contact the person who shared this link.
                    </p>
                </div>

                <!-- Footer -->
                <div style="text-align: center; margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--glass-border);">
                    <a href="{{ url_for('url_shortener.index') }}" style="font-size: 14px;">
                        üè† Create Your Own Short Link
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
        // Toggle password visibility
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('toggleIcon');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                toggleIcon.textContent = 'üëÅÔ∏è';
            }
        }

        // Toast notification function
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show' + (isError ? ' toast-error' : ' toast-success');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Show error toast if there's an error
        {% if error %}
        window.addEventListener('load', () => {
            showToast('‚ùå Incorrect password. Please try again.', true);

            // Shake the input field
            const input = document.getElementById('password');
            input.classList.add('shake');
            setTimeout(() => {
                input.classList.remove('shake');
            }, 500);

            // Focus and select the input
            input.focus();
            input.select();
        });
        {% endif %}

        // Form submission handling
        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            const password = document.getElementById('password').value;

            if (!password) {
                e.preventDefault();
                showToast('‚ö†Ô∏è Please enter a password', true);
                return;
            }

            if (password.length < 8) {
                e.preventDefault();
                showToast('‚ö†Ô∏è Password must be at least 8 characters', true);
                return;
            }

            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'üîì Unlocking...';
            submitBtn.disabled = true;

            // Re-enable after a delay if form fails to submit
            setTimeout(() => {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }, 3000);
        });

        // Keyboard shortcut: Enter to submit
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('passwordForm').submit();
            }
        });

        // Auto-focus on password input
        window.addEventListener('load', () => {
            document.getElementById('password').focus();
        });
    </script>
</body>
</html>
